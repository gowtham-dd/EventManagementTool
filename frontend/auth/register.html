<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - SKASC Event Manager</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <div class="text-center mb-6">
                <div class="w-20 h-20 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user-plus text-white text-2xl"></i>
                </div>
                <h2 class="auth-title">Create Account</h2>
                <p class="auth-subtitle">SKASC Members Only</p>
            </div>

            <form id="registerForm">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" id="name" class="form-input" placeholder="John Doe" required>
                    <div class="form-error" id="nameError"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">SKASC Email</label>
                    <input type="email" id="email" class="form-input" placeholder="you@skasc.ac.in" required>
                    <div class="form-error" id="emailError"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="password" class="form-input" placeholder="••••••••" required>
                    <div class="form-error" id="passwordError"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" id="confirmPassword" class="form-input" placeholder="••••••••" required>
                    <div class="form-error" id="confirmPasswordError"></div>
                </div>

                <button type="submit" class="btn btn-primary btn-full">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
            </form>

            <div class="auth-link">
                <p>Already have an account? <a href="/auth/login.html">Sign in here</a></p>
                <p><a href="/">← Back to Home</a></p>
            </div>
        </div>
    </div>

    <script src="/js/api.js"></script>
    <script src="/js/utils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registerForm');
            
            // If already logged in, redirect to dashboard
            if (localStorage.getItem('token')) {
                window.location.href = '/dashboard/dashboard.html';
            }

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const name = document.getElementById('name').value.trim();
                const email = document.getElementById('email').value.trim().toLowerCase();
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                // Clear previous errors
                document.querySelectorAll('.form-error').forEach(el => {
                    el.style.display = 'none';
                });
                
                let hasError = false;
                
                // Validate name
                if (name.length < 2) {
                    document.getElementById('nameError').textContent = 'Name must be at least 2 characters';
                    document.getElementById('nameError').style.display = 'block';
                    hasError = true;
                }
                
                // Validate email
                const emailPattern = /^[a-zA-Z0-9._%+-]+@skasc\.ac\.in$/;
                if (!emailPattern.test(email)) {
                    document.getElementById('emailError').textContent = 'Please use a valid @skasc.ac.in email';
                    document.getElementById('emailError').style.display = 'block';
                    hasError = true;
                }
                
                // Validate password
                if (password.length < 6) {
                    document.getElementById('passwordError').textContent = 'Password must be at least 6 characters';
                    document.getElementById('passwordError').style.display = 'block';
                    hasError = true;
                }
                
                // Validate password match
                if (password !== confirmPassword) {
                    document.getElementById('confirmPasswordError').textContent = 'Passwords do not match';
                    document.getElementById('confirmPasswordError').style.display = 'block';
                    hasError = true;
                }
                
                if (hasError) return;
                
                Utils.showLoading();
                
                try {
                    console.log('Attempting registration...');
                    const response = await window.API.register(email, password, name);
                    
                    Utils.showSuccessModal('Registration successful!', () => {
                        window.location.href = '/dashboard/dashboard.html';
                    });
                    
                } catch (error) {
                    Utils.hideLoading();
                    console.error('Registration error:', error);
                    
                    // Show specific error message
                    let errorMessage = error.message || 'Registration failed';
                    if (errorMessage.includes('Only @skasc.ac.in emails allowed')) {
                        document.getElementById('emailError').textContent = 'Only @skasc.ac.in emails are allowed';
                        document.getElementById('emailError').style.display = 'block';
                    } else if (errorMessage.includes('already registered')) {
                        document.getElementById('emailError').textContent = 'Email already registered';
                        document.getElementById('emailError').style.display = 'block';
                    } else {
                        Utils.showError(errorMessage);
                    }
                }
            });
        });
    </script>
</body>
</html>